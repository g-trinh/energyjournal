{
  "swagger": "2.0",
  "info": {
    "description": "HTTP API for user management and calendar spending data.",
    "title": "Energy Journal API",
    "contact": {},
    "version": "1.0"
  },
  "basePath": "/",
  "paths": {
    "/energy/levels": {
      "get": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Returns the energy levels (physical, mental, emotional) recorded by the authenticated user for the given date. Returns 404 if no record exists for that date.",
        "produces": [
          "application/json"
        ],
        "tags": [
          "energy"
        ],
        "summary": "Get energy levels for a date",
        "parameters": [
          {
            "type": "string",
            "example": "2026-02-21",
            "description": "Calendar date (YYYY-MM-DD)",
            "name": "date",
            "in": "query",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/energy.EnergyLevelsResponse"
            }
          },
          "400": {
            "description": "Bad Request — missing or malformed date",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "403": {
            "description": "Forbidden — inactive user",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "404": {
            "description": "Not Found — no record for this date",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          }
        }
      },
      "put": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Creates or overwrites the energy levels for the authenticated user on the given date. All three dimension values must be integers in [0, 10].",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "energy"
        ],
        "summary": "Save (upsert) energy levels for a date",
        "parameters": [
          {
            "description": "Energy levels payload",
            "name": "request",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/energy.SaveEnergyLevelsRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/energy.EnergyLevelsResponse"
            }
          },
          "400": {
            "description": "Bad Request — validation failure",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "403": {
            "description": "Forbidden — inactive user",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/energy.ErrorResponse"
            }
          }
        }
      }
    },
    "/calendar/spending": {
      "get": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Returns spending totals by category between two dates (inclusive).",
        "produces": [
          "application/json"
        ],
        "tags": [
          "calendar"
        ],
        "summary": "Get spending aggregates",
        "parameters": [
          {
            "type": "string",
            "example": "2026-01-01",
            "description": "Start date (YYYY-MM-DD)",
            "name": "start",
            "in": "query",
            "required": true
          },
          {
            "type": "string",
            "example": "2026-01-31",
            "description": "End date (YYYY-MM-DD)",
            "name": "end",
            "in": "query",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/calendar.SpendingResponse"
            }
          },
          "400": {
            "description": "Bad Request",
            "schema": {
              "$ref": "#/definitions/calendar.ErrorResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/calendar.ErrorResponse"
            }
          },
          "404": {
            "description": "Not Found",
            "schema": {
              "$ref": "#/definitions/calendar.ErrorResponse"
            }
          },
          "500": {
            "description": "Internal Server Error",
            "schema": {
              "$ref": "#/definitions/calendar.ErrorResponse"
            }
          }
        }
      }
    },
    "/healthz": {
      "get": {
        "description": "Returns service liveness status.",
        "produces": [
          "text/plain"
        ],
        "tags": [
          "health"
        ],
        "summary": "Health check",
        "responses": {
          "200": {
            "description": "ok",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/users": {
      "post": {
        "description": "Creates a new user account and triggers an activation email. Returns the same success response when the email already exists to prevent account enumeration.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Create user",
        "parameters": [
          {
            "description": "Create user payload",
            "name": "request",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/user.CreateUserRequest"
            }
          }
        ],
        "responses": {
          "201": {
            "description": "Accepted",
            "schema": {
              "$ref": "#/definitions/user.CreateUserAcceptedResponse"
            }
          },
          "400": {
            "description": "Invalid request",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          }
        }
      }
    },
    "/users/activate": {
      "post": {
        "description": "Activates a pending user account using a query token. Activation tokens are one-time use and expire after 24 hours.",
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Activate user",
        "parameters": [
          {
            "type": "string",
            "description": "Activation token",
            "name": "token",
            "in": "query",
            "required": true
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/user.ActivationResponse"
            }
          },
          "400": {
            "description": "Invalid request",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "404": {
            "description": "Not found",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          }
        }
      }
    },
    "/users/login": {
      "post": {
        "description": "Authenticates a user and returns auth tokens. For any login failure (unknown email, wrong password, inactive account, deleted account), the API returns the same generic message.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Login user",
        "parameters": [
          {
            "description": "Login payload",
            "name": "request",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/user.LoginRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/user.AuthTokensResponse"
            }
          },
          "400": {
            "description": "Invalid request",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          }
        }
      }
    },
    "/users/me": {
      "get": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Returns the authenticated and active user's profile.",
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Get current user profile",
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/user.UserResponse"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "type": "string"
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "type": "string"
            }
          }
        }
      },
      "put": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Updates the authenticated and active user's profile fields.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Update current user profile",
        "parameters": [
          {
            "description": "Update user payload",
            "name": "request",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/user.UpdateUserRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/user.UserResponse"
            }
          },
          "400": {
            "description": "Invalid request",
            "schema": {
              "type": "string"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "type": "string"
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "type": "string"
            }
          }
        }
      },
      "delete": {
        "security": [
          {
            "BearerAuth": []
          }
        ],
        "description": "Soft-deletes the authenticated and active user.",
        "produces": [
          "text/plain"
        ],
        "tags": [
          "users"
        ],
        "summary": "Delete current user profile",
        "responses": {
          "204": {
            "description": "No Content",
            "schema": {
              "type": "string"
            }
          },
          "401": {
            "description": "Unauthorized",
            "schema": {
              "type": "string"
            }
          },
          "403": {
            "description": "Forbidden",
            "schema": {
              "type": "string"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "type": "string"
            }
          }
        }
      }
    },
    "/users/refresh": {
      "post": {
        "description": "Exchanges a refresh token for a new auth token pair. Refresh failures return a generic error response.",
        "consumes": [
          "application/json"
        ],
        "produces": [
          "application/json"
        ],
        "tags": [
          "users"
        ],
        "summary": "Refresh auth token",
        "parameters": [
          {
            "description": "Refresh token payload",
            "name": "request",
            "in": "body",
            "required": true,
            "schema": {
              "$ref": "#/definitions/user.RefreshRequest"
            }
          }
        ],
        "responses": {
          "200": {
            "description": "OK",
            "schema": {
              "$ref": "#/definitions/user.AuthTokensResponse"
            }
          },
          "400": {
            "description": "Invalid request",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          },
          "500": {
            "description": "Internal server error",
            "schema": {
              "$ref": "#/definitions/user.GenericErrorResponse"
            }
          }
        }
      }
    }
  },
  "definitions": {
    "energy.EnergyLevelsResponse": {
      "type": "object",
      "properties": {
        "date": {
          "type": "string",
          "example": "2026-02-21"
        },
        "physical": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "mental": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "emotional": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        }
      }
    },
    "energy.SaveEnergyLevelsRequest": {
      "type": "object",
      "required": [
        "date",
        "physical",
        "mental",
        "emotional"
      ],
      "properties": {
        "date": {
          "type": "string",
          "example": "2026-02-21",
          "description": "Calendar date in YYYY-MM-DD format"
        },
        "physical": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "mental": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        },
        "emotional": {
          "type": "integer",
          "minimum": 0,
          "maximum": 10
        }
      }
    },
    "energy.ErrorResponse": {
      "type": "object",
      "properties": {
        "error": {
          "type": "string"
        }
      }
    },
    "calendar.ErrorResponse": {
      "type": "object",
      "properties": {
        "error": {
          "type": "string"
        }
      }
    },
    "calendar.SpendingResponse": {
      "type": "object",
      "additionalProperties": {
        "type": "number"
      }
    },
    "user.AuthTokensResponse": {
      "type": "object",
      "properties": {
        "expiresIn": {
          "type": "string"
        },
        "idToken": {
          "type": "string"
        },
        "refreshToken": {
          "type": "string"
        }
      }
    },
    "user.CreateUserRequest": {
      "type": "object",
      "properties": {
        "email": {
          "type": "string"
        },
        "firstname": {
          "type": "string"
        },
        "lastname": {
          "type": "string"
        },
        "password": {
          "type": "string"
        },
        "timezone": {
          "type": "string",
          "description": "Optional. Frontend should initialize this value from the browser timezone."
        },
        "confirmPassword": {
          "type": "string"
        }
      },
      "required": [
        "email",
        "password",
        "confirmPassword"
      ]
    },
    "user.LoginRequest": {
      "type": "object",
      "properties": {
        "email": {
          "type": "string"
        },
        "password": {
          "type": "string"
        }
      },
      "required": [
        "email",
        "password"
      ]
    },
    "user.RefreshRequest": {
      "type": "object",
      "properties": {
        "refreshToken": {
          "type": "string"
        }
      },
      "required": [
        "refreshToken"
      ]
    },
    "user.UpdateUserRequest": {
      "type": "object",
      "properties": {
        "firstname": {
          "type": "string"
        },
        "lastname": {
          "type": "string"
        },
        "timezone": {
          "type": "string"
        }
      }
    },
    "user.UserResponse": {
      "type": "object",
      "properties": {
        "createdAt": {
          "type": "string"
        },
        "email": {
          "type": "string"
        },
        "firstname": {
          "type": "string"
        },
        "lastname": {
          "type": "string"
        },
        "status": {
          "type": "string"
        },
        "timezone": {
          "type": "string"
        },
        "uid": {
          "type": "string"
        }
      }
    },
    "user.GenericErrorResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string"
        }
      }
    },
    "user.ActivationResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string"
        }
      }
    },
    "user.CreateUserAcceptedResponse": {
      "type": "object",
      "properties": {
        "message": {
          "type": "string",
          "example": "Check your email to activate your account."
        },
        "status": {
          "type": "string",
          "example": "pending_activation"
        }
      }
    }
  },
  "securityDefinitions": {
    "BearerAuth": {
      "type": "apiKey",
      "name": "Authorization",
      "in": "header"
    }
  }
}
